
    <div class="container" *ngIf="!isActivityFinished; else completedTemplate">
      <h2 class="title">{{ getText(content.title) }}</h2>
      
      <mat-card class="intro-card">
        <mat-card-content>
          <p>{{ getText(content.introduction) }}</p>
        </mat-card-content>
      </mat-card>

      <!-- Word Choices Pool -->
      <h3 class="instruction">{{ getText({ta: 'பொருத்தமான சொல்லை இழுத்துவிடவும்', en: 'Drag and drop the correct word', si: 'නිවැරදි වචනය ඇද දමන්න'}) }}</h3>
      <mat-card class="word-pool" 
                (dragover)="handleDragOver($event)"
                (drop)="handleDrop($event, 'pool')">
        <mat-card-content>
          <mat-chip-listbox>
            <mat-chip-option 
              *ngFor="let word of wordChoices" 
              [draggable]="true"
              (dragstart)="handleDragStart($event, word)"
              class="draggable-chip">
              {{ getText(word.text) }}
            </mat-chip-option>
          </mat-chip-listbox>
        </mat-card-content>
      </mat-card>

      <!-- Sentences with Blanks -->
      <div class="sentences-container">
        <mat-card *ngFor="let sentence of content.sentences; let i = index" 
                  class="sentence-card"
                  (dragover)="handleDragOver($event)"
                  (drop)="handleDrop($event, sentence.id)">
          <mat-card-content>
            <div class="sentence-content">
              <span class="sentence-text">{{ getText(sentence.preBlankText) }}</span>
              <div class="blank-space" 
                   [class.filled]="getSelectedWordForSentence(sentence.id)"
                   [class.correct]="isCorrectAnswer(sentence.id)"
                   [class.incorrect]="isIncorrectAnswer(sentence.id)">
                <span *ngIf="getSelectedWordForSentence(sentence.id)">
                  {{ getText(getSelectedWordForSentence(sentence.id)!.text) }}
                </span>
                <span *ngIf="!getSelectedWordForSentence(sentence.id)" class="blank-placeholder">
                  ___
                </span>
              </div>
              <span class="sentence-text" *ngIf="sentence.postBlankText">{{ getText(sentence.postBlankText) }}</span>
              <button mat-icon-button 
                      color="primary" 
                      (click)="playAudio(sentence.audioUrl)"
                      class="audio-button">
                <mat-icon>volume_up</mat-icon>
              </button>
            </div>
          </mat-card-content>
        </mat-card>
      </div>

      <!-- Submit Button -->
      <div class="submit-container">
        <button mat-raised-button 
                color="primary" 
                (click)="submitAnswers()"
                [disabled]="!canSubmit()">
          சரிபார்க்க
        </button>
      </div>

      <audio #audioRef style="display: none;"></audio>
    </div>

    <!-- Completed Template -->
    <ng-template #completedTemplate>
      <div class="completion-container">
        <mat-card class="completion-card">
          <mat-card-content>
            <div class="completion-content">
              <mat-icon class="completion-icon" [class.success]="allCorrect" [class.error]="!allCorrect">
                {{ allCorrect ? 'check_circle' : 'error' }}
              </mat-icon>
              <h3 class="completion-title">
                {{ allCorrect ? getText({ta: 'வாழ்த்துக்கள்!', en: 'Congratulations!', si: 'සුභ පැතුම්!'}) : getText({ta: 'மீண்டும் முயற்சிக்கவும்', en: 'Try Again', si: 'නැවත උත්සාහ කරන්න'}) }}
              </h3>
              <p class="completion-message">
                {{ allCorrect ? getText({ta: 'அனைத்து பதில்களும் சரியானவை!', en: 'All answers are correct!', si: 'සියලු පිළිතුරු නිවැරදිය!'}) : getText({ta: 'சில பதில்கள் தவறானவை. மீண்டும் முயற்சிக்கவும்.', en: 'Some answers are incorrect. Please try again.', si: 'සමහර පිළිතුරු වැරදිය. නැවත උත්සාහ කරන්න.'}) }}
              </p>
              <div class="score-display">
                <h4>
                  {{ getText({ta: 'மதிப்பெண்', en: 'Score', si: 'ලකුණු'}) }}: {{ correctAnswers }}/{{ content.sentences.length }}
                </h4>
              </div>
              <button mat-raised-button 
                      color="primary" 
                      (click)="resetActivity()"
                      class="reset-button">
                {{ getText({ta: 'மீண்டும் முயற்சிக்கவும்', en: 'Try Again', si: 'නැවත උත්සාහ කරන්න'}) }}
              </button>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </ng-template>
  